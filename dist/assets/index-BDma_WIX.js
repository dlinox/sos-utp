import{l as B,d as E,e as c,r as a,o as _,c as g,w as t,a as e,u as w,m as Q,q as W,g as b,f as J,h as F,i as C,t as X,n as H,p as L,F as M}from"./index-CqlVs-0d.js";import{i as Y,_ as Z}from"./DialogConfirm.vue_vue_type_script_setup_true_lang-C_UyCIvg.js";import{r as q}from"./ruleUtils-DaB-ACZt.js";import{c as h}from"./worker.services-C9vxp5II.js";const D="https://api.fuas.linox.net.pe/api/users",ee=async d=>{try{const l=localStorage.getItem("token");return(await B(l,D).post("/load-data-table",d)).data.data}catch{return Y()}},te=async d=>{try{const l=localStorage.getItem("token");return await B(l,D).post("/save",d),!0}catch{return!1}},oe=async d=>{try{const l=localStorage.getItem("token");return await B(l,D).delete(`/delete/${d}`),!0}catch{return!1}},se=async()=>{try{const d=localStorage.getItem("token"),l=await B(d,D).get("/all-permissions");return console.log(l.data),l.data.data}catch{return[]}},ae=async d=>{try{const l=localStorage.getItem("token");return await B(l,D).post("/assign-permissions/",d),!0}catch{return!1}},z={email:[q],password:[],workerId:[q],status:[q]},le=()=>({id:null,email:"",password:null,workerId:null,permissions:[],status:!0}),K=E({__name:"Form",props:{formState:{type:Object,default:()=>({})}},emits:["onSuccess"],setup(d,{emit:l}){const m=l,i=d,o=c(null),p=c(!1),u=c(!1),n=c({...le(),...i.formState}),f=c([]),y=async()=>{const{valid:r}=await o.value.validate();if(console.log(n.value),!r)return;await te(n.value)&&(n.value.id==null&&o.value.reset(),m("onSuccess"),u.value=!1),p.value=!1};return(async()=>{f.value=await h()})(),(r,s)=>{const I=a("v-list-item"),P=a("v-select"),k=a("v-col"),x=a("v-text-field"),T=a("v-switch"),S=a("v-row"),N=a("v-card-item"),R=a("v-btn"),O=a("v-spacer"),j=a("v-card-actions"),A=a("v-card"),V=a("v-form"),$=a("v-dialog");return _(),g($,{"max-width":"700",modelValue:u.value,"onUpdate:modelValue":s[5]||(s[5]=v=>u.value=v),activator:"parent"},{default:t(()=>[e(V,{ref_key:"formRef",ref:o,onSubmit:J(y,["prevent"])},{default:t(()=>[e(A,{title:n.value.id?"Editar Registro":"Nuevo Registro"},{default:t(()=>[e(N,{class:"border-t border-b"},{default:t(()=>[e(S,null,{default:t(()=>[e(k,{cols:"12"},{default:t(()=>[e(P,{modelValue:n.value.workerId,"onUpdate:modelValue":s[0]||(s[0]=v=>n.value.workerId=v),label:"Trabajador",items:f.value,rules:w(z).workerId},{item:t(({props:v,item:G})=>[e(I,Q(v,{title:G.title,disabled:G.raw.hasUser=="1"}),null,16,["title","disabled"])]),_:1},8,["modelValue","items","rules"])]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(x,{modelValue:n.value.email,"onUpdate:modelValue":s[1]||(s[1]=v=>n.value.email=v),label:"Correo electrónico",rules:w(z).email,autocomplete:"off"},null,8,["modelValue","rules"])]),_:1}),n.value.id?W("",!0):(_(),g(k,{key:0,cols:"12"},{default:t(()=>[e(x,{modelValue:n.value.password,"onUpdate:modelValue":s[2]||(s[2]=v=>n.value.password=v),label:"Contraseña",rules:w(z).password,type:"password",autocomplete:"new-password"},null,8,["modelValue","rules"])]),_:1})),e(k,{cols:"12"},{default:t(()=>[e(T,{label:n.value.status?"Habilitado":"Deshabilitado",modelValue:n.value.status,"onUpdate:modelValue":s[3]||(s[3]=v=>n.value.status=v),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(R,{type:"button",variant:"text",color:"secondary",onClick:s[4]||(s[4]=v=>u.value=!1)},{default:t(()=>s[6]||(s[6]=[b(" Cancelar ")])),_:1}),e(O),e(R,{text:"Guardar",color:"primary",type:"submit",loading:p.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),ne=[{title:"Op.",key:"actions",value:"actions",fixed:!0,width:"50px",sortable:!1},{title:"Nombre Completo",key:"fullName",value:"fullName"},{title:"Correo",key:"email",value:"email"},{title:"Estado",key:"status",value:"status"}],re=E({__name:"DataTable",props:{options:{},items:{},loading:{type:Boolean},total:{}},emits:["onUpdateTable"],setup(d,{emit:l}){const m=l;return(i,o)=>{const p=a("v-icon"),u=a("v-list-item"),n=a("v-list"),f=a("v-menu"),y=a("v-btn"),U=a("v-data-table-server"),r=F("permission");return _(),g(U,{"items-per-page":i.options.itemsPerPage,"onUpdate:itemsPerPage":[o[1]||(o[1]=s=>i.options.itemsPerPage=s),o[4]||(o[4]=s=>m("onUpdateTable"))],"sort-by":i.options.sortBy,"onUpdate:sortBy":[o[2]||(o[2]=s=>i.options.sortBy=s),o[5]||(o[5]=s=>m("onUpdateTable"))],page:i.options.page,"onUpdate:page":[o[3]||(o[3]=s=>i.options.page=s),o[6]||(o[6]=s=>m("onUpdateTable"))],headers:w(ne),items:i.items,"items-length":i.total,loading:i.loading,"item-value":"id","multi-sort":""},{"item.actions":t(({item:s})=>[e(y,{icon:"",density:"compact",variant:"text"},{default:t(()=>[e(p,null,{default:t(()=>o[7]||(o[7]=[b("mdi-dots-vertical")])),_:1}),e(f,{activator:"parent"},{default:t(()=>[e(n,{density:"compact"},{default:t(()=>[C((_(),g(u,{key:"permissions",value:"permissions",class:"text-subtitle-2"},{append:t(()=>[e(p,{size:"small"},{default:t(()=>o[8]||(o[8]=[b(" mdi-lock ")])),_:1})]),default:t(()=>[o[9]||(o[9]=b(" Asignar permisos ")),e(w(ie),{permissions:s.permissions,userId:s.id},null,8,["permissions","userId"])]),_:2},1024)),[[r,["users.assign-permissions"]]]),C((_(),g(u,{key:"edit",value:"edit",class:"text-subtitle-2"},{append:t(()=>[e(p,{size:"small"},{default:t(()=>o[10]||(o[10]=[b(" mdi-pencil ")])),_:1})]),default:t(()=>[o[11]||(o[11]=b(" Editar ")),e(w(K),{formState:s,onOnSuccess:o[0]||(o[0]=I=>m("onUpdateTable"))},null,8,["formState"])]),_:2},1024)),[[r,["users.edit"]]]),C((_(),g(u,{key:"delete",value:"delete",class:"text-red text-subtitle-2"},{append:t(()=>[e(p,{size:"small",color:"red"},{default:t(()=>o[12]||(o[12]=[b(" mdi-delete ")])),_:1})]),default:t(()=>[e(Z,{title:"Eliminar",message:"¿Está seguro de eliminar este registro?",onOnConfirm:async()=>{await w(oe)(s.id)&&m("onUpdateTable")}},null,8,["onOnConfirm"]),o[13]||(o[13]=b(" Eliminar "))]),_:2},1024)),[[r,["users.delete"]]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":t(({item:s})=>[e(y,{color:s.status?"blue":"error","text-color":"white",density:"compact",variant:"tonal"},{default:t(()=>[b(X(s.status?"Habilitado":"Deshabilitado"),1)]),_:2},1032,["color"])]),_:1},8,["items-per-page","sort-by","page","headers","items","items-length","loading"])}}}),ie=E({__name:"AssignPermissions",props:{userId:{},permissions:{}},emits:["onSuccess"],setup(d,{emit:l}){const m=d,i=c({userId:m.userId,permissions:[]}),o=c(null),p=c(!1),u=c([...m.permissions]),n=async()=>{i.value.permissions=u.value;let U=await ae(i.value);console.log(U)},f=c([]);return(async()=>{f.value=await se()})(),(U,r)=>{const s=a("v-checkbox"),I=a("v-col"),P=a("v-row"),k=a("v-expansion-panel-text"),x=a("v-expansion-panel"),T=a("v-expansion-panels"),S=a("v-btn"),N=a("v-spacer"),R=a("v-card-actions"),O=a("v-card"),j=a("v-form"),A=a("v-dialog");return _(),g(A,{"max-width":"1000",modelValue:p.value,"onUpdate:modelValue":r[2]||(r[2]=V=>p.value=V),activator:"parent"},{default:t(()=>[e(j,{ref_key:"formRef",ref:o,onSubmit:J(n,["prevent"])},{default:t(()=>[e(O,{title:"Asignar permisos"},{default:t(()=>[e(T,null,{default:t(()=>[(_(!0),H(M,null,L(f.value,V=>(_(),g(x,{key:V.id,title:V.description},{default:t(()=>[e(k,null,{default:t(()=>[e(P,null,{default:t(()=>[(_(!0),H(M,null,L(V.children,$=>(_(),g(I,{cols:"12",sm:"6",md:"4",class:"ma-0 pa-1",key:$.id},{default:t(()=>[e(s,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=v=>u.value=v),label:$.description,value:$.id},null,8,["modelValue","label","value"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1}),e(R,null,{default:t(()=>[e(S,{type:"button",variant:"text",color:"secondary",onClick:r[1]||(r[1]=V=>p.value=!1)},{default:t(()=>r[3]||(r[3]=[b(" Cancelar ")])),_:1}),e(N),e(S,{text:"Guardar",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),ce=E({__name:"index",setup(d){const l=c(!1),m=c(!1),i=c([]),o=c(0),p=c({itemsPerPage:10,sortBy:[],page:1,search:"",filters:{}}),u=async()=>{m.value=!0;const f=await ee(p.value);i.value=f.data,o.value=f.total,m.value=!1},n=async()=>{l.value=!0,await u(),l.value=!1};return n(),(f,y)=>{const U=a("v-text-field"),r=a("v-col"),s=a("v-btn"),I=a("v-row"),P=a("v-card-item"),k=a("v-card"),x=F("permission"),T=F("tooltip");return _(),g(k,{title:"Usuarios",subtitle:"Gestión de usuarios",disabled:l.value},{default:t(()=>[e(P,{class:"border-t border-b"},{default:t(()=>[e(I,{class:"d-flex justify-space-between"},{default:t(()=>[e(r,{cols:"12",md:"4"},{default:t(()=>[e(U,{modelValue:p.value.search,"onUpdate:modelValue":y[0]||(y[0]=S=>p.value.search=S),label:"Buscar",clearable:"",onInput:u},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:t(()=>[C((_(),g(s,{class:"h-md-auto me-2",disabled:l.value},{default:t(()=>[y[1]||(y[1]=b(" nuevo ")),e(w(K),{onOnSuccess:u})]),_:1},8,["disabled"])),[[x,["users.create"]]]),C(e(s,{class:"h-md-auto",density:"comfortable",icon:"mdi-reload",onClick:n,loading:m.value},null,8,["loading"]),[[T,"Recargar registros"],[x,["users.index"]]])]),_:1})]),_:1})]),_:1}),C(e(w(re),{options:p.value,loading:m.value,items:i.value,total:o.value,onOnUpdateTable:u},null,8,["options","loading","items","total"]),[[x,["users.index"]]])]),_:1},8,["disabled"])}}});export{ce as default};
