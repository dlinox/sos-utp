import{l as P,d as E,e as c,r as o,o as _,c as b,w as e,a as t,u as R,g as u,f as H,h as O,i as I,n as q,p as G,F as M,t as B,b as J}from"./index-CqlVs-0d.js";import{i as K,_ as Q}from"./DialogConfirm.vue_vue_type_script_setup_true_lang-C_UyCIvg.js";import{r as j}from"./ruleUtils-DaB-ACZt.js";import{d as W}from"./debounce-DqPPCsFD.js";const A="https://api.fuas.linox.net.pe/api/categories",X=async f=>{try{const r=localStorage.getItem("token");return(await P(r,A).post("/load-data-table",f)).data.data}catch{return K()}},Y=async f=>{try{const r=localStorage.getItem("token");return await P(r,A).post("/save",f),!0}catch{return!1}},Z=async f=>{try{const r=localStorage.getItem("token");return await P(r,A).delete(`/delete/${f}`),!0}catch{return!1}},z={name:[j],type:[j]},h=()=>({id:null,name:"",type:null,status:!0,services:[]}),L=E({__name:"Form",props:{formState:{type:Object,default:()=>({})}},emits:["onSuccess"],setup(f,{emit:r}){const d=r,m=f,v=c(!1),i=c(!1),a=c(null),l=c({...h(),...m.formState}),g=async()=>{const{valid:p}=await a.value.validate();if(!p)return;v.value=!0,await Y(l.value)&&(l.value.id==null&&a.value.reset(),d("onSuccess"),i.value=!1),v.value=!1};return(p,n)=>{const U=o("v-text-field"),y=o("v-col"),S=o("v-select"),k=o("v-switch"),x=o("v-row"),s=o("v-card-item"),w=o("v-btn"),N=o("v-spacer"),D=o("v-card-actions"),$=o("v-card"),V=o("v-form"),T=o("v-dialog");return _(),b(T,{"max-width":"700",modelValue:i.value,"onUpdate:modelValue":n[4]||(n[4]=C=>i.value=C),activator:"parent"},{default:e(()=>[t(V,{ref_key:"formRef",ref:a,onSubmit:H(g,["prevent"])},{default:e(()=>[t($,{title:l.value.id?"Editar Registro":"Nuevo Registro"},{default:e(()=>[t(s,{class:"border-t border-b"},{default:e(()=>[t(x,null,{default:e(()=>[t(y,{cols:"12"},{default:e(()=>[t(U,{modelValue:l.value.name,"onUpdate:modelValue":n[0]||(n[0]=C=>l.value.name=C),label:"Nombre",rules:R(z).name},null,8,["modelValue","rules"])]),_:1}),t(y,{cols:"12"},{default:e(()=>[t(S,{modelValue:l.value.type,"onUpdate:modelValue":n[1]||(n[1]=C=>l.value.type=C),items:["ASISTENCIAL","ADMINISTRATIVO"],label:"Tipo",rules:R(z).type},null,8,["modelValue","rules"])]),_:1}),t(y,{cols:"12"},{default:e(()=>[t(k,{label:l.value.status?"Habilitado":"Deshabilitado",modelValue:l.value.status,"onUpdate:modelValue":n[2]||(n[2]=C=>l.value.status=C),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),t(D,null,{default:e(()=>[t(w,{type:"button",variant:"text",color:"secondary",onClick:n[3]||(n[3]=C=>i.value=!1)},{default:e(()=>n[5]||(n[5]=[u(" Cancelar ")])),_:1}),t(N),t(w,{text:"Guardar",color:"primary",type:"submit",loading:v.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),ee=[{title:"Op.",key:"actions",value:"actions",fixed:!0,width:"50px",sortable:!1},{title:"Nombre",key:"name",value:"name"},{title:"Tipo",key:"type",value:"type"},{title:"Estado",key:"status",value:"status"}],te={name:[j]},oe=()=>({id:null,name:"",categoryId:null,status:!0}),ae="https://api.fuas.linox.net.pe/api/services",le=async f=>{try{const r=localStorage.getItem("token");return await P(r,ae).post("/save",f),!0}catch{return!1}},F=E({__name:"ServiceForm",props:{formState:{type:Object,default:()=>({})},categoryId:{type:Number,required:!0}},emits:["onSuccess"],setup(f,{emit:r}){const d=r,m=f,v=c(!1),i=c(!1),a=c(null),l=c({...oe(),...m.formState,categoryId:m.categoryId}),g=async()=>{const{valid:p}=await a.value.validate();if(!p)return;v.value=!0,await le(l.value)&&(l.value.id==null&&a.value.reset(),d("onSuccess"),i.value=!1),v.value=!1};return(p,n)=>{const U=o("v-text-field"),y=o("v-col"),S=o("v-switch"),k=o("v-row"),x=o("v-card-item"),s=o("v-btn"),w=o("v-spacer"),N=o("v-card-actions"),D=o("v-card"),$=o("v-form"),V=o("v-dialog");return _(),b(V,{"max-width":"700",modelValue:i.value,"onUpdate:modelValue":n[3]||(n[3]=T=>i.value=T),activator:"parent"},{default:e(()=>[t($,{ref_key:"formRef",ref:a,onSubmit:H(g,["prevent"])},{default:e(()=>[t(D,{title:l.value.id?"Editar Registro":"Nuevo Registro"},{default:e(()=>[t(x,{class:"border-t border-b"},{default:e(()=>[t(k,null,{default:e(()=>[t(y,{cols:"12"},{default:e(()=>[t(U,{modelValue:l.value.name,"onUpdate:modelValue":n[0]||(n[0]=T=>l.value.name=T),label:"Nombre",rules:R(te).name},null,8,["modelValue","rules"])]),_:1}),t(y,{cols:"12"},{default:e(()=>[t(S,{label:l.value.status?"Habilitado":"Deshabilitado",modelValue:l.value.status,"onUpdate:modelValue":n[1]||(n[1]=T=>l.value.status=T),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(s,{type:"button",variant:"text",color:"secondary",onClick:n[2]||(n[2]=T=>i.value=!1)},{default:e(()=>n[4]||(n[4]=[u(" Cancelar ")])),_:1}),t(w),t(s,{text:"Guardar",color:"primary",type:"submit",loading:v.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),ne=E({__name:"service",props:{category:{}},emits:["onUpdate"],setup(f,{emit:r}){const d=r,m=c(!1),v=c(!1);return(()=>{console.log("init")})(),(a,l)=>{const g=o("v-col"),p=o("v-btn"),n=o("v-row"),U=o("v-card-item"),y=o("v-list-item-title"),S=o("v-icon"),k=o("v-list-item"),x=o("v-list"),s=o("v-menu"),w=o("v-chip"),N=o("v-card"),D=o("v-dialog"),$=O("permission");return _(),b(D,{"max-width":"600",modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=V=>m.value=V),activator:"parent","max-height":"600"},{default:e(()=>[t(N,{title:"Servicios",subtitle:a.category.type+" - "+a.category.name,disabled:v.value},{default:e(()=>[t(U,{class:"border-t border-b"},{default:e(()=>[t(n,{class:"d-flex justify-space-between"},{default:e(()=>[t(g,{cols:"12",md:"7"}),t(g,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:e(()=>[I((_(),b(p,{class:"me-2",disabled:v.value},{default:e(()=>[l[3]||(l[3]=u(" nuevo ")),t(F,{onOnSuccess:l[0]||(l[0]=V=>d("onUpdate")),categoryId:a.category.id},null,8,["categoryId"])]),_:1},8,["disabled"])),[[$,["categories.services.create"]]])]),_:1})]),_:1})]),_:1}),I((_(),b(x,null,{default:e(()=>[(_(!0),q(M,null,G(a.category.services,V=>(_(),b(k,{key:V.id},{prepend:e(()=>[I((_(),b(p,{icon:"",size:"small",variant:"text"},{default:e(()=>[t(S,{size:"small",color:"grey"},{default:e(()=>l[4]||(l[4]=[u(" mdi-dots-vertical ")])),_:1}),t(s,{activator:"parent"},{default:e(()=>[t(x,{density:"compact"},{default:e(()=>[I((_(),b(k,{key:"edit",value:"edit","append-icon":"mdi-pencil",class:"text-subtitle-2"},{append:e(()=>[t(S,{size:"small"},{default:e(()=>l[5]||(l[5]=[u(" mdi-pencil ")])),_:1})]),default:e(()=>[l[6]||(l[6]=u(" Editar ")),t(F,{onOnSuccess:l[1]||(l[1]=T=>d("onUpdate")),categoryId:a.category.id,formState:V},null,8,["categoryId","formState"])]),_:2},1024)),[[$,["categories.services.edit"]]])]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[$,["categories.services.edit"]]])]),append:e(()=>[t(w,{color:V.status?"success":"error","text-color":"white"},{default:e(()=>[u(B(V.status?"Habilitado":"Deshabilitado"),1)]),_:2},1032,["color"])]),default:e(()=>[t(y,null,{default:e(()=>[u(B(V.name),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})),[[$,["categories.services.index"]]])]),_:1},8,["subtitle","disabled"])]),_:1},8,["modelValue"])}}}),se={class:"d-flex align-center"},ie=E({__name:"DataTable",props:{options:{},items:{},loading:{type:Boolean},total:{}},emits:["onUpdateTable"],setup(f,{emit:r}){const d=r,m=c(!1),v=async i=>{m.value=!0,await Z(i)&&d("onUpdateTable"),m.value=!1};return(i,a)=>{const l=o("v-icon"),g=o("v-btn"),p=o("v-list-item"),n=o("v-list"),U=o("v-menu"),y=o("v-chip"),S=o("v-data-table-server"),k=O("tooltip"),x=O("permission");return _(),b(S,{"items-per-page":i.options.itemsPerPage,"onUpdate:itemsPerPage":[a[2]||(a[2]=s=>i.options.itemsPerPage=s),a[5]||(a[5]=s=>d("onUpdateTable"))],"sort-by":i.options.sortBy,"onUpdate:sortBy":[a[3]||(a[3]=s=>i.options.sortBy=s),a[6]||(a[6]=s=>d("onUpdateTable"))],page:i.options.page,"onUpdate:page":[a[4]||(a[4]=s=>i.options.page=s),a[7]||(a[7]=s=>d("onUpdateTable"))],headers:R(ee),items:i.items,"items-length":i.total,loading:m.value,"item-value":"id","multi-sort":""},{"item.actions":e(({item:s})=>[J("div",se,[I((_(),b(g,{icon:"",density:"compact",color:"black",variant:"text"},{default:e(()=>[t(l,null,{default:e(()=>a[8]||(a[8]=[u("mdi-format-list-bulleted-type")])),_:1}),t(ne,{category:s,onOnUpdate:a[0]||(a[0]=w=>d("onUpdateTable"))},null,8,["category"])]),_:2},1024)),[[k,"Servicios de "+s.name],[x,["categories.services.index"]]]),t(g,{icon:"",density:"compact",variant:"text"},{default:e(()=>[t(l,null,{default:e(()=>a[9]||(a[9]=[u("mdi-dots-vertical")])),_:1}),t(U,{activator:"parent"},{default:e(()=>[t(n,{density:"compact"},{default:e(()=>[I((_(),b(p,{key:"edit",value:"edit","append-icon":"mdi-pencil",class:"text-subtitle-2"},{append:e(()=>[t(l,{size:"small"},{default:e(()=>a[10]||(a[10]=[u(" mdi-pencil ")])),_:1})]),default:e(()=>[a[11]||(a[11]=u(" Editar ")),t(R(L),{formState:s,onOnSuccess:a[1]||(a[1]=w=>d("onUpdateTable"))},null,8,["formState"])]),_:2},1024)),[[x,["categories.edit"]]]),I((_(),b(p,{key:"delete",value:"delete",class:"text-red text-subtitle-2"},{append:e(()=>[t(l,{size:"small",color:"red"},{default:e(()=>a[12]||(a[12]=[u(" mdi-delete ")])),_:1})]),default:e(()=>[a[13]||(a[13]=u(" Eliminar ")),t(Q,{title:"Eliminar",message:"¿Está seguro de eliminar este registro?","text-cancel":"No","text-confirm":"Confirmar",loading:m.value,onOnConfirm:()=>v(s.id)},null,8,["loading","onOnConfirm"])]),_:2},1024)),[[x,["categories.delete"]]])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"item.type":e(({item:s})=>[t(y,{color:s.type==="ASISTENCIAL"?"teal-darken-3":"blue-grey-darken-1","text-color":"white"},{default:e(()=>[u(B(s.type),1)]),_:2},1032,["color"])]),"item.status":e(({item:s})=>[t(g,{color:s.status?"blue":"error","text-color":"white",density:"compact",variant:"tonal"},{default:e(()=>[u(B(s.status?"Habilitado":"Deshabilitado"),1)]),_:2},1032,["color"])]),_:1},8,["items-per-page","sort-by","page","headers","items","items-length","loading"])}}}),me=E({__name:"index",setup(f){const r=c(!1),d=c(!1),m=c([]),v=c(0),i=c({itemsPerPage:10,sortBy:[],page:1,search:"",filters:{}}),a=W(()=>{l()},400),l=async()=>{d.value=!0;const p=await X(i.value);m.value=p.data,v.value=p.total,d.value=!1},g=async()=>{r.value=!0,await l(),r.value=!1};return g(),(p,n)=>{const U=o("v-text-field"),y=o("v-col"),S=o("v-btn"),k=o("v-row"),x=o("v-card-item"),s=o("v-card"),w=O("permission"),N=O("tooltip");return _(),b(s,{title:"Categorías",subtitle:"Gestion de categorías",disabled:r.value},{default:e(()=>[t(x,{class:"border-t border-b"},{default:e(()=>[t(k,{class:"d-flex justify-space-between"},{default:e(()=>[t(y,{cols:"12",md:"4"},{default:e(()=>[t(U,{modelValue:i.value.search,"onUpdate:modelValue":n[0]||(n[0]=D=>i.value.search=D),label:"Buscar",clearable:"",onInput:R(a)},null,8,["modelValue","onInput"])]),_:1}),t(y,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:e(()=>[I((_(),b(S,{class:"h-md-auto me-2",disabled:r.value},{default:e(()=>[n[1]||(n[1]=u(" nuevo ")),t(R(L),{onOnSuccess:l})]),_:1},8,["disabled"])),[[w,["categories.create"]]]),I(t(S,{class:"h-md-auto",density:"comfortable",icon:"mdi-reload",onClick:g,loading:d.value},null,8,["loading"]),[[N,"Recargar registros"],[w,["categories.index"]]])]),_:1})]),_:1})]),_:1}),I(t(R(ie),{options:i.value,loading:d.value,items:m.value,total:v.value,onOnUpdateTable:l},null,8,["options","loading","items","total"]),[[w,["categories.index"]]])]),_:1},8,["disabled"])}}});export{me as default};
